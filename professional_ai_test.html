<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI人格特質測驗 - 發現你的AI人格類型</title>
    <meta name="description" content="全球首創AI人格特質測驗，發現你是哪種AI人格類型！">
    <meta property="og:title" content="AI人格特質測驗 - 你是AI先鋒者還是AI學者？">
    <meta property="og:description" content="3分鐘發現你的AI人格特質，加入全球排名！">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/667eea/ffffff?text=AI%E4%BA%BA%E6%A0%BC%E7%89%B9%E8%B3%AA%E6%B8%AC%E9%A9%97">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .hero-section {
            text-align: center;
            padding: 60px 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            margin-bottom: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
            background-size: 200% 100%;
            animation: rainbow 3s linear infinite;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .hero-title {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 20px;
            color: #666;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .personality-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
        }

        .personality-type {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 15px;
            transition: transform 0.3s ease;
        }

        .personality-type:hover {
            transform: translateY(-3px);
        }

        .personality-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .personality-name {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }

        .creator-badge {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .creator-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(255, 107, 107, 0.4);
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .test-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin: 40px 0;
            position: relative;
            overflow: hidden;
        }

        .user-form {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            border: 2px solid rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .progress-container {
            margin-bottom: 40px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .question-container {
            opacity: 0;
            transform: translateX(50px);
            animation: slideIn 0.6s ease forwards;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .question-number {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question-title {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
            line-height: 1.3;
        }

        .options-grid {
            display: grid;
            gap: 15px;
            margin: 30px 0;
        }

        .option-card {
            background: white;
            border: 2px solid #e8ecf4;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .option-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
        }

        .option-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.02);
        }

        .option-label {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .option-description {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.4;
        }

        .result-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            display: none;
            position: relative;
            overflow: hidden;
        }

        .result-container.show {
            display: block;
            animation: resultAppear 0.8s ease forwards;
        }

        @keyframes resultAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .personality-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 120px;
            height: 120px;
            font-size: 48px;
            margin-bottom: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
        }

        .result-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .result-subtitle {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .result-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .personality-traits {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .trait-card {
            background: rgba(102, 126, 234, 0.1);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .trait-name {
            font-size: 16px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .trait-stars {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .star {
            color: #ffd700;
            font-size: 20px;
            margin: 0 2px;
        }

        .star.empty {
            color: #ddd;
        }

        .global-stats {
            background: linear-gradient(135deg, #e3f2fd, #f0f8ff);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border: 2px solid #2196f3;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-big-number {
            font-size: 32px;
            font-weight: 800;
            color: #2196f3;
            margin-bottom: 5px;
        }

        .stat-description {
            font-size: 14px;
            color: #666;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-block;
            margin: 10px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 15px 40px rgba(240, 147, 251, 0.4);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .leaderboard-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin: 40px 0;
            display: none;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 20px;
            margin: 10px 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }

        .rank-number {
            font-size: 24px;
            font-weight: 800;
            color: #667eea;
            min-width: 50px;
            text-align: center;
        }

        .user-info {
            flex-grow: 1;
            margin-left: 20px;
        }

        .username {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .user-details {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .user-personality {
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }

        .medal {
            font-size: 32px;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 36px;
            }
            
            .test-container, .result-container {
                padding: 30px 20px;
                margin: 20px 0;
                border-radius: 20px;
            }
            
            .question-title {
                font-size: 24px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .personality-traits {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 標題區域 -->
        <div class="hero-section">
            <h1 class="hero-title">🧠 AI人格特質測驗</h1>
            <p class="hero-subtitle">發現你獨特的AI人格類型</p>
            <p style="color: #888; margin-bottom: 20px;">
                3分鐘了解你的AI使用人格，找到專屬的AI夥伴類型！
            </p>
            
            <div class="personality-preview">
                <div class="personality-type">
                    <div class="personality-icon">🚀</div>
                    <div class="personality-name">AI先鋒者</div>
                </div>
                <div class="personality-type">
                    <div class="personality-icon">🎨</div>
                    <div class="personality-name">AI創意家</div>
                </div>
                <div class="personality-type">
                    <div class="personality-icon">⚡</div>
                    <div class="personality-name">AI效率王</div>
                </div>
                <div class="personality-type">
                    <div class="personality-icon">🔬</div>
                    <div class="personality-name">AI學者</div>
                </div>
            </div>
            
            <a href="https://portaly.cc/zn.studio" target="_blank" class="creator-badge">
                <span style="margin-right: 8px;">💡</span>
                由 Nick Chang | ZN Studio 創作
            </a>
        </div>

        <!-- 即時統計 -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">載入中...</div>
                <div class="stat-label">全球參與人數</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mostCommon">載入中...</div>
                <div class="stat-label">最常見人格</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rarest">載入中...</div>
                <div class="stat-label">最稀有人格</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="onlineNow">載入中...</div>
                <div class="stat-label">目前在線</div>
            </div>
        </div>

        <!-- 測驗區域 -->
        <div class="test-container" id="testContainer">
            <!-- 用戶資料表單 -->
            <div class="user-form">
                <h3 style="color: #2c3e50; margin-bottom: 20px; text-align: center;">
                    📝 請填寫基本資料以加入全球排名
                </h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="username">暱稱 *</label>
                        <input type="text" id="username" placeholder="請輸入你的暱稱" required maxlength="20">
                    </div>
                    <div class="form-group">
                        <label for="location">地區</label>
                        <select id="location">
                            <option value="">選擇地區（可選）</option>
                            <option value="台北">台北</option>
                            <option value="新北">新北</option>
                            <option value="桃園">桃園</option>
                            <option value="台中">台中</option>
                            <option value="台南">台南</option>
                            <option value="高雄">高雄</option>
                            <option value="其他台灣地區">其他台灣地區</option>
                            <option value="香港">香港</option>
                            <option value="新加坡">新加坡</option>
                            <option value="馬來西亞">馬來西亞</option>
                            <option value="中國大陸">中國大陸</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="occupation">職業</label>
                        <select id="occupation">
                            <option value="">選擇職業（可選）</option>
                            <option value="學生">學生</option>
                            <option value="工程師">工程師</option>
                            <option value="設計師">設計師</option>
                            <option value="行銷人員">行銷人員</option>
                            <option value="創業者">創業者</option>
                            <option value="教師">教師</option>
                            <option value="醫護人員">醫護人員</option>
                            <option value="金融業">金融業</option>
                            <option value="服務業">服務業</option>
                            <option value="自由工作者">自由工作者</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ageGroup">年齡層</label>
                        <select id="ageGroup">
                            <option value="">選擇年齡層（可選）</option>
                            <option value="18-24">18-24歲</option>
                            <option value="25-34">25-34歲</option>
                            <option value="35-44">35-44歲</option>
                            <option value="45-54">45-54歲</option>
                            <option value="55+">55歲以上</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">準備開始測驗</div>
            </div>

            <div class="question-container" id="questionContainer">
                <div style="text-align: center; padding: 40px;">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">🧠 探索你的AI人格特質</h2>
                    <p style="color: #666; margin-bottom: 30px;">
                        通過8個問題，了解你與AI互動的獨特風格和偏好
                    </p>
                    <button class="btn" onclick="startTest()" style="font-size: 18px; padding: 20px 50px;">
                        🚀 開始探索
                    </button>
                </div>
            </div>
        </div>

        <!-- 結果區域 -->
        <div class="result-container" id="resultContainer">
            <div class="personality-badge" id="personalityBadge">🚀</div>
            <h2 class="result-title" id="resultTitle">AI先鋒者</h2>
            <p class="result-subtitle" id="resultSubtitle">"AI的未來，我來創造！"</p>
            <p class="result-description" id="resultDescription">結果描述</p>

            <div class="personality-traits">
                <div class="trait-card">
                    <div class="trait-name">創新探索</div>
                    <div class="trait-stars" id="innovation-stars"></div>
                </div>
                <div class="trait-card">
                    <div class="trait-name">效率提升</div>
                    <div class="trait-stars" id="efficiency-stars"></div>
                </div>
                <div class="trait-card">
                    <div class="trait-name">創意表達</div>
                    <div class="trait-stars" id="creativity-stars"></div>
                </div>
                <div class="trait-card">
                    <div class="trait-name">深度理解</div>
                    <div class="trait-stars" id="understanding-stars"></div>
                </div>
            </div>

            <div class="global-stats">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">🌍 你在全球的位置</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-big-number" id="personalityRank">#127</div>
                        <div class="stat-description">同類型排名</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-big-number" id="personalityPercent">23%</div>
                        <div class="stat-description">全球佔比</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-big-number" id="totalRank">#456</div>
                        <div class="stat-description">總體排名</div>
                    </div>
                </div>
            </div>

            <div style="margin: 40px 0;">
                <button class="btn" onclick="shareResult()">
                    📤 分享我的AI人格
                </button>
                <button class="btn btn-secondary" onclick="showLeaderboard()">
                    🏆 查看人格排行榜
                </button>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: rgba(102, 126, 234, 0.1); border-radius: 15px;">
                <p style="color: #666; font-size: 14px; margin-bottom: 10px;">
                    <strong>想了解更多AI人格特質？</strong>
                </p>
                <p style="color: #888; font-size: 12px; margin-bottom: 15px;">
                    加入Nick Chang的Line社群，與同類型夥伴交流！
                </p>
                <a href="https://reurl.cc/1OZNAY" target="_blank" class="btn" style="font-size: 14px; padding: 12px 24px;">
                    🎯 加入AI人格社群
                </a>
            </div>
        </div>

        <!-- 排行榜區域 -->
        <div class="leaderboard-section" id="leaderboardSection">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">🏆 AI人格排行榜</h2>
            <div id="leaderboardContent">
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner"></div>
                    <p>載入排行榜中...</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="hideLeaderboard()">返回結果</button>
            </div>
        </div>
    </div>

    <script>
        // ===============================
        // Firebase 設定區域（保持原有）
        // ===============================
        
        const firebaseConfig = {
            apiKey: "AIzaSyAqwdMVnhrj0Ktj9BTEOVJdpzBLPpMaTq",
            authDomain: "ai-level-test.firebaseapp.com", 
            projectId: "ai-level-test",
            storageBucket: "ai-level-test.firebasestorage.app",
            messagingSenderId: "774029966921",
            appId: "1:774029966921:web:5bceaeb011e665f4ccc40c",
            measurementId: "G-TH0M0VXRZC"
        };

        let db = null;
        let firebaseInitialized = false;

        function initializeFirebase() {
            try {
                if (firebaseConfig.apiKey !== "API須更新") {
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.firestore();
                    firebaseInitialized = true;
                    console.log('Firebase 初始化成功');
                    setupRealTimeStats();
                } else {
                    console.log('Firebase 配置未完成，使用模擬模式');
                    simulateStats();
                }
            } catch (error) {
                console.error('Firebase 初始化失敗:', error);
                simulateStats();
            }
        }

        // ===============================
        // AI人格測驗核心邏輯
        // ===============================
        
        let currentQuestion = 0;
        let answers = {};
        let startTime = Date.now();
        let userResult = null;

        // AI人格類型定義
        const personalityTypes = {
            pioneer: {
                icon: '🚀',
                name: 'AI先鋒者',
                subtitle: '"AI的未來，我來創造！"',
                animal: '雄鷹 🦅',
                description: '你總是第一個接觸新AI技術的人！具有強烈的探索精神和創新思維，喜歡嘗試各種前沿AI工具，並能敏銳地洞察AI發展趨勢。你不僅是AI的使用者，更是AI時代的引領者，用你的熱情和遠見影響著周圍的人。',
                traits: {
                    innovation: 5,
                    efficiency: 4,
                    creativity: 4,
                    understanding: 3
                }
            },
            creator: {
                icon: '🎨',
                name: 'AI創意家',
                subtitle: '"AI是我的創意夥伴！"',
                animal: '蝴蝶 🦋',
                description: '你擁有豐富的想像力和創造力！善於運用AI進行藝術創作、內容生成和創意表達。你將AI視為創意的延伸，能夠與AI協作產出令人驚艷的作品。你的創作總是充滿個性和感染力，激發他人的創意靈感。',
                traits: {
                    innovation: 4,
                    efficiency: 3,
                    creativity: 5,
                    understanding: 3
                }
            },
            efficiency: {
                icon: '⚡',
                name: 'AI效率王',
                subtitle: '"效率就是生產力！"',
                animal: '獵豹 🐆',
                description: '你是追求效率和結果的實踐者！專注於運用AI工具提升工作和學習效率，能夠快速找到最適合的AI解決方案。你的時間管理能力極強，總是能用最短的時間達成最佳效果。你是職場上的AI效率專家。',
                traits: {
                    innovation: 3,
                    efficiency: 5,
                    creativity: 3,
                    understanding: 4
                }
            },
            scholar: {
                icon: '🔬',
                name: 'AI學者',
                subtitle: '"知識就是力量！"',
                animal: '貓頭鷹 🦉',
                description: '你是AI領域的深度思考者！喜歡探究AI的工作原理和技術細節，具有強烈的求知慾和學習能力。你重視知識的準確性和深度，能夠理性分析AI的優劣勢。你的見解總是深刻而有價值，是他人學習AI的可靠導師。',
                traits: {
                    innovation: 3,
                    efficiency: 4,
                    creativity: 3,
                    understanding: 5
                }
            }
        };

        // 重新設計的問題庫（AI人格導向）
        const questions = [
            {
                title: "你最初開始使用AI是因為？",
                options: [
                    { label: "🚀 聽說很酷，想嘗試新科技", desc: "對新事物充滿好奇，喜歡探索前沿技術", type: 'pioneer' },
                    { label: "🎨 想要實現創意想法", desc: "希望用AI來輔助創作和表達", type: 'creator' },
                    { label: "⚡ 工作需要，提升效率", desc: "為了解決實際問題，提高工作效率", type: 'efficiency' },
                    { label: "🔬 想深入了解AI原理", desc: "對AI技術本身感興趣，想學習知識", type: 'scholar' }
                ]
            },
            {
                title: "面對新的AI工具，你通常會？",
                options: [
                    { label: "🎯 馬上下載試用", desc: "立即嘗試，邊用邊學", type: 'pioneer' },
                    { label: "🎨 想像創作可能性", desc: "思考能用它創造什麼有趣的作品", type: 'creator' },
                    { label: "📊 評估實用價值", desc: "分析它能為工作帶來什麼幫助", type: 'efficiency' },
                    { label: "📚 先研究技術文檔", desc: "了解原理和功能後再使用", type: 'scholar' }
                ]
            },
            {
                title: "你最喜歡用AI做什麼？",
                options: [
                    { label: "🔬 探索各種可能性", desc: "嘗試AI的各種功能和應用場景", type: 'pioneer' },
                    { label: "🎭 創作和表達想法", desc: "用AI進行藝術創作、內容生成", type: 'creator' },
                    { label: "📈 解決工作問題", desc: "用AI處理日常任務，提升效率", type: 'efficiency' },
                    { label: "📖 學習和研究", desc: "用AI輔助學習，深入理解知識", type: 'scholar' }
                ]
            },
            {
                title: "當你發現AI的新功能時，你會？",
                options: [
                    { label: "📢 立即分享給朋友", desc: "興奮地告訴大家這個發現", type: 'pioneer' },
                    { label: "💡 思考創作靈感", desc: "考慮如何用於自己的創作", type: 'creator' },
                    { label: "🎯 評估工作應用", desc: "分析如何應用到實際工作中", type: 'efficiency' },
                    { label: "🔍 深入研究細節", desc: "詳細了解功能原理和限制", type: 'scholar' }
                ]
            },
            {
                title: "你覺得AI最吸引你的地方是？",
                options: [
                    { label: "🌟 無限的可能性", desc: "AI技術的發展前景和未來潛力", type: 'pioneer' },
                    { label: "🎨 創意的延伸", desc: "能幫助實現以前無法做到的創意", type: 'creator' },
                    { label: "⚡ 效率的提升", desc: "大幅提高工作和生活效率", type: 'efficiency' },
                    { label: "🧠 智能的奧秘", desc: "AI背後的技術原理和運作方式", type: 'scholar' }
                ]
            },
            {
                title: "在AI學習路上，你最重視？",
                options: [
                    { label: "🚀 緊跟最新趨勢", desc: "總是關注最新的AI發展動態", type: 'pioneer' },
                    { label: "🎪 激發創意靈感", desc: "學習如何用AI激發更多創意", type: 'creator' },
                    { label: "📊 掌握實用技能", desc: "學習能直接應用的實用技巧", type: 'efficiency' },
                    { label: "📚 建立知識體系", desc: "系統化地學習AI相關知識", type: 'scholar' }
                ]
            },
            {
                title: "你希望AI在你生活中扮演什麼角色？",
                options: [
                    { label: "🧭 探險夥伴", desc: "一起探索未知的技術前沿", type: 'pioneer' },
                    { label: "🎨 創作搭檔", desc: "協助實現各種創意想法", type: 'creator' },
                    { label: "⚙️ 效率工具", desc: "幫助處理各種日常任務", type: 'efficiency' },
                    { label: "📖 智慧導師", desc: "提供知識和深入的見解", type: 'scholar' }
                ]
            },
            {
                title: "對於AI的未來發展，你最期待？",
                options: [
                    { label: "🌍 改變世界的突破", desc: "期待AI帶來革命性的變化", type: 'pioneer' },
                    { label: "🎭 更豐富的創作可能", desc: "希望AI能支援更多創意表達", type: 'creator' },
                    { label: "🔧 更實用的功能", desc: "期待更高效便利的AI工具", type: 'efficiency' },
                    { label: "🧠 更深層的智能", desc: "希望AI能達到更高的智能水準", type: 'scholar' }
                ]
            }
        ];

        // ===============================
        // 測驗流程（保持原有結構）
        // ===============================

        function startTest() {
            const username = document.getElementById('username').value.trim();
            if (!username) {
                alert('請填寫暱稱才能開始測驗！');
                document.getElementById('username').focus();
                return;
            }

            currentQuestion = 0;
            answers = {};
            startTime = Date.now();
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestion >= questions.length) {
                calculatePersonality();
                return;
            }

            const question = questions[currentQuestion];
            const container = document.getElementById('questionContainer');
            
            container.style.opacity = '0';
            setTimeout(() => {
                container.innerHTML = `
                    <div class="question-number">問題 ${currentQuestion + 1}</div>
                    <h2 class="question-title">${question.title}</h2>
                    <div class="options-grid">
                        ${question.options.map((option, index) => `
                            <div class="option-card" onclick="selectOption('${option.type}')">
                                <div class="option-label">${option.label}</div>
                                <div class="option-description">${option.desc}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.style.opacity = '1';
                updateProgress();
            }, 300);
        }

        function selectOption(type) {
            answers[currentQuestion] = type;
            
            const options = document.querySelectorAll('.option-card');
            options.forEach(option => option.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            setTimeout(() => {
                currentQuestion++;
                loadQuestion();
            }, 800);
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `問題 ${currentQuestion + 1} / ${questions.length}`;
        }

        async function calculatePersonality() {
            // 計算AI人格類型
            const typeCounts = {};
            Object.values(answers).forEach(type => {
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });
            
            // 找出最多的類型
            const dominantType = Object.keys(typeCounts).reduce((a, b) => 
                typeCounts[a] > typeCounts[b] ? a : b
            );

            const userData = {
                username: document.getElementById('username').value.trim(),
                location: document.getElementById('location').value || '未知',
                occupation: document.getElementById('occupation').value || '未知', 
                age_group: document.getElementById('ageGroup').value || '未知',
                personality_type: dominantType,
                type_scores: typeCounts,
                answers: answers
            };

            showLoading('正在分析你的AI人格特質...');
            
            const result = await submitPersonalityResult(userData);
            
            hideLoading();
            
            userResult = {
                ...userData,
                rank: result.rank,
                userId: result.userId
            };
            
            showPersonalityResult(dominantType, result);
        }

        function showPersonalityResult(personalityType, result) {
            const personality = personalityTypes[personalityType];
            
            document.getElementById('testContainer').style.display = 'none';
            
            // 設定人格徽章和基本資訊
            document.getElementById('personalityBadge').textContent = personality.icon;
            document.getElementById('resultTitle').textContent = personality.name;
            document.getElementById('resultSubtitle').textContent = personality.subtitle;
            document.getElementById('resultDescription').textContent = personality.description;
            
            // 設定特質星級
            setTraitStars('innovation', personality.traits.innovation);
            setTraitStars('efficiency', personality.traits.efficiency);
            setTraitStars('creativity', personality.traits.creativity);
            setTraitStars('understanding', personality.traits.understanding);
            
            // 設定排名資訊（模擬）
            const typePercentage = getPersonalityPercentage(personalityType);
            document.getElementById('personalityRank').textContent = `#${Math.floor(Math.random() * 100) + 1}`;
            document.getElementById('personalityPercent').textContent = `${typePercentage}%`;
            document.getElementById('totalRank').textContent = `#${result.rank}`;
            
            document.getElementById('resultContainer').classList.add('show');
            document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
            
            createCelebration();
        }

        function setTraitStars(traitId, level) {
            const container = document.getElementById(`${traitId}-stars`);
            container.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('span');
                star.className = i <= level ? 'star' : 'star empty';
                star.textContent = '★';
                container.appendChild(star);
            }
        }

        function getPersonalityPercentage(type) {
            const percentages = {
                pioneer: 23,
                creator: 28,
                efficiency: 31,
                scholar: 18
            };
            return percentages[type] || 25;
        }

        // ===============================
        // 保持原有的輔助函數
        // ===============================

        async function submitPersonalityResult(userData) {
            if (!firebaseInitialized) {
                return {
                    success: true,
                    rank: Math.floor(Math.random() * 1000) + 100,
                    userId: 'demo_' + Date.now()
                };
            }

            try {
                const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                const testData = {
                    ...userData,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    ip_hash: await hashIP(await getUserIP()),
                    user_agent: navigator.userAgent,
                    test_duration: Math.floor((Date.now() - startTime) / 1000)
                };
                
                await db.collection('personality_rankings').doc(userId).set(testData);
                await updatePersonalityStats(testData);
                
                const userRank = await calculateUserRank(userData.personality_type);
                
                return { success: true, rank: userRank, userId: userId };
            } catch (error) {
                console.error('儲存失敗:', error);
                return { 
                    success: false, 
                    error: error.message,
                    rank: Math.floor(Math.random() * 1000) + 100
                };
            }
        }

        async function updatePersonalityStats(userData) {
            if (!firebaseInitialized) return;
            
            const statsRef = db.collection('personality_stats').doc('global');
            
            await db.runTransaction(async (transaction) => {
                const doc = await transaction.get(statsRef);
                
                if (!doc.exists) {
                    transaction.set(statsRef, {
                        total_users: 1,
                        personality_distribution: {
                            [userData.personality_type]: 1
                        },
                        last_updated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    const currentStats = doc.data();
                    transaction.update(statsRef, {
                        total_users: firebase.firestore.FieldValue.increment(1),
                        [`personality_distribution.${userData.personality_type}`]: firebase.firestore.FieldValue.increment(1),
                        last_updated: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            });
        }

        function simulateStats() {
            const mockStats = {
                total_users: 15847,
                most_common: 'AI效率王',
                rarest: 'AI學者',
                online_now: 2341
            };
            updateStatsUI(mockStats);
            
            setInterval(() => {
                mockStats.total_users += Math.floor(Math.random() * 3);
                mockStats.online_now = Math.floor(mockStats.total_users * (0.1 + Math.random() * 0.2));
                updateStatsUI(mockStats);
            }, 10000);
        }

        function updateStatsUI(stats) {
            document.getElementById('totalUsers').textContent = stats.total_users?.toLocaleString() || '15,847';
            document.getElementById('mostCommon').textContent = stats.most_common || 'AI效率王';
            document.getElementById('rarest').textContent = stats.rarest || 'AI學者';
            document.getElementById('onlineNow').textContent = stats.online_now?.toLocaleString() || '2,341';
        }

        function shareResult() {
            if (!userResult) return;
            
            const personality = personalityTypes[userResult.personality_type];
            const shareText = `我剛完成了AI人格特質測驗！

🎯 我的AI人格：${personality.name}
${personality.subtitle}
🦅 我的AI夥伴：${personality.animal}

你的AI人格是什麼？快來測試看看！

由 Nick Chang | ZN Studio 創作
#AI人格測驗 #${personality.name} #人工智慧`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'AI人格特質測驗結果',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText + '\n\n' + window.location.href).then(() => {
                    showNotification('結果已複製到剪貼簿！快去分享你的AI人格吧 🎉');
                });
            }
        }

        // ===============================
        // 保持原有的所有其他函數
        // ===============================

        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }

        async function hashIP(ip) {
            const encoder = new TextEncoder();
            const data = encoder.encode(ip + 'ai-personality-salt');
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function calculateUserRank(personalityType) {
            if (!firebaseInitialized) return Math.floor(Math.random() * 500) + 50;
            
            try {
                const snapshot = await db.collection('personality_rankings')
                    .where('personality_type', '==', personalityType)
                    .get();
                return Math.floor(Math.random() * Math.max(1, snapshot.size)) + 1;
            } catch (error) {
                return Math.floor(Math.random() * 500) + 50;
            }
        }

        function setupRealTimeStats() {
            if (!firebaseInitialized) return;
            
            db.collection('personality_stats').doc('global')
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const stats = doc.data();
                        const distribution = stats.personality_distribution || {};
                        
                        // 計算最常見和最稀有的人格類型
                        const sortedTypes = Object.entries(distribution)
                            .sort((a, b) => b[1] - a[1]);
                        
                        const mostCommon = sortedTypes[0] ? personalityTypes[sortedTypes[0][0]]?.name : 'AI效率王';
                        const rarest = sortedTypes[sortedTypes.length - 1] ? personalityTypes[sortedTypes[sortedTypes.length - 1][0]]?.name : 'AI學者';
                        
                        updateStatsUI({
                            total_users: stats.total_users,
                            most_common: mostCommon,
                            rarest: rarest,
                            online_now: Math.floor(stats.total_users * 0.15)
                        });
                    }
                });
        }

        // 保持所有原有的UI函數
        function showLoading(message) {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.id = 'loadingOverlay';
            overlay.innerHTML = `
                <div class="loading-content">
                    <div class="spinner"></div>
                    <p style="color: #666; margin: 0;">${message}</p>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.remove();
        }

        function createCelebration() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.innerHTML = ['🎉', '✨', '🎊', '⭐'][Math.floor(Math.random() * 4)];
                    confetti.style.cssText = `
                        position: fixed;
                        left: ${Math.random() * 100}vw;
                        top: -10px;
                        font-size: 20px;
                        z-index: 1000;
                        pointer-events: none;
                        animation: fall ${Math.random() * 3 + 2}s linear forwards;
                    `;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }, i * 100);
            }
        }

        async function showLeaderboard() {
            document.getElementById('leaderboardSection').style.display = 'block';
            document.getElementById('leaderboardSection').scrollIntoView({ behavior: 'smooth' });
            
            // 模擬排行榜數據
            const mockLeaderboard = generatePersonalityLeaderboard();
            const content = document.getElementById('leaderboardContent');
            
            content.innerHTML = mockLeaderboard.map((user, index) => {
                const medal = user.rank === 1 ? '🥇' : user.rank === 2 ? '🥈' : user.rank === 3 ? '🥉' : '';
                const personality = personalityTypes[user.personality_type];
                const isCurrentUser = userResult && user.id === userResult.userId;
                
                return `
                    <div class="leaderboard-item" style="${isCurrentUser ? 'background: linear-gradient(135deg, #e3f2fd, #f0f8ff); border: 2px solid #2196f3;' : ''}">
                        ${medal ? `<div class="medal">${medal}</div>` : ''}
                        <div class="rank-number">#${user.rank}</div>
                        <div class="user-info">
                            <div class="username">${user.username} ${isCurrentUser ? '(你)' : ''}</div>
                            <div class="user-details">${user.location} · ${user.occupation}</div>
                        </div>
                        <div class="user-personality">${personality.icon} ${personality.name}</div>
                    </div>
                `;
            }).join('');
        }

        function generatePersonalityLeaderboard() {
            const names = ['AI探索家', '科技達人', '創意大師', '效率專家', '智慧學者', '創新先鋒'];
            const locations = ['台北', '上海', '香港', '新加坡', '台中', '深圳'];
            const occupations = ['工程師', '設計師', '學生', '創業者', '行銷人員', '產品經理'];
            const types = ['pioneer', 'creator', 'efficiency', 'scholar'];
            
            return Array.from({length: 20}, (_, i) => ({
                rank: i + 1,
                id: `mock_${i}`,
                username: names[Math.floor(Math.random() * names.length)] + (Math.floor(Math.random() * 999) + 1),
                location: locations[Math.floor(Math.random() * locations.length)],
                occupation: occupations[Math.floor(Math.random() * occupations.length)],
                personality_type: types[Math.floor(Math.random() * types.length)]
            }));
        }

        function hideLeaderboard() {
            document.getElementById('leaderboardSection').style.display = 'none';
            document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                animation: slideInRight 0.5s ease forwards;
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease forwards';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeFirebase();
        });

        // 添加動畫CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                    opacity: 0;
                }
            }
            
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // 防止測驗進行中離開頁面
        window.addEventListener('beforeunload', function(e) {
            if (currentQuestion > 0 && currentQuestion < questions.length) {
                e.preventDefault();
                e.returnValue = '你的測驗進度將會遺失，確定要離開嗎？';
            }
        });
    </script>
</body>
</html>
